# AI Knowledge Dashboard リニューアル計画

## 1. コンセプト
**「NotionライクなモダンUI」** を目指し、情報のストック・フロー両面で使いやすいダッシュボードへ刷新する。
GAS + スプレッドシートの構成を維持しつつ、SPA（Single Page Application）ライクな挙動とURLによる状態管理（Deep Linking）を実現する。

## 2. UI/UX設計

### 2.1 レイアウト構成
画面を左右に分割する2カラムレイアウトを採用。

*   **左：サイドバー（固定）**
    *   **検索ボックス**: フリーワード検索（リアルタイムフィルタ）。
    *   **新規作成ボタン**: 投稿モーダル/画面を開く。
    *   **メニュー**:
        *   🏠 **ホーム（ダッシュボード）**: カテゴリごとの新着・人気などをサマリ表示。
        *   ⭐ **お気に入り (Favorite)**: 自分がいいねした記事一覧。
    *   **カテゴリ（大きな枠組み）**:
        *   📰 **気になる記事** (Articles)
        *   ❓ **相談・質問** (Questions)
        *   🤝 **仲間募集** (Recruitment)
        *   🎁 **成果物紹介** (Showcase)
    *   **タグ一覧**: 使用頻度の高いタグトップ10などを表示。

*   **右：メインエリア（可変）**
    *   選択されたメニューに応じたコンテンツを表示。
    *   **一覧表示**: カード型レイアウト（カテゴリごとに最適化）。
    *   **詳細表示**: モーダルではなく、全画面（またはオーバーレイ）でリッチに表示。

### 2.2 URL設計 (Deep Linking)
クエリパラメータ `page` と `id` を使用して状態を管理する。

| 画面 | URLパターン | 挙動 |
| :--- | :--- | :--- |
| **ホーム** | `/exec` | ダッシュボードを表示。 |
| **カテゴリ一覧** | `/exec?page=category&type=articles` | 特定カテゴリの一覧を表示。 |
| **詳細記事** | `/exec?id=123` | 指定IDの記事詳細を表示（pageパラメータなしでもID優先）。 |
| **タグ検索** | `/exec?page=tag&name=gas` | 特定タグの記事一覧を表示。 |
| **お気に入り** | `/exec?page=favorite` | お気に入り一覧を表示。 |

## 3. 機能要件詳細

### 3.1 カテゴリと入力フォーマット
4つのカテゴリごとに、入力項目と表示項目を最適化する。

| カテゴリ | キー | 特有の入力項目 | 表示時の特徴 |
| :--- | :--- | :--- | :--- |
| **気になる記事** | `article` | 参照URL (必須), 要約 | URLのOGP（もし取得できれば）やサムネイルを強調。 |
| **相談・質問** | `question` | 現状の課題, 解決希望日 | 「未解決/解決済み」のステータス管理。 |
| **仲間募集** | `recruitment` | プロジェクト概要, 募集ロール | 「募集中/終了」ステータス。募集ロールをタグのように表示。 |
| **成果物紹介** | `showcase` | デモURL, GitHub URL, 工夫点 | スクリーンショット（サムネイル）を大きく表示。 |

※ 共通項目: タイトル, 詳細説明(Markdown), タグ, 投稿者

### 3.2 リッチテキストエディタ (Markdown)
詳細説明欄には **EasyMDE** (またはSimpleMDE) を導入。
*   **機能**: 太字、リスト、リンク、引用などの入力補助ツールバー。
*   **プレビュー**: 入力しながらプレビューが見られる、または切り替え表示。

### 3.3 タグ管理
*   **入力UI**: 既存のタグを候補として表示するオートコンプリート機能。
*   **データソース**: 記事データから全タグを集計して候補リストを動的に生成（マスタシートは作らずメンテナンスフリーに）。

## 4. データモデル設計 (スプレッドシート)

現在の1シート構成では限界があるため、機能ごとにシートを分割する（正規化）。

### 4.1 シート構成案

#### 1. `Posts` シート (メイン)
記事の基本情報を格納。カテゴリごとの特殊項目はJSON形式で `metadata` 列に格納することで、列の乱立を防ぐ。

| 列 | 項目名 | 内容 |
| :--- | :--- | :--- |
| A | `id` | ユニークID (数値 or UUID) |
| B | `category` | `article`, `question`, `recruitment`, `showcase` |
| C | `title` | タイトル |
| D | `content` | 詳細説明 (Markdown本文) |
| E | `tags` | タグ (カンマ区切り or JSON配列) |
| F | `postedBy` | 投稿者名 |
| G | `postedAt` | 投稿日時 |
| H | `updatedAt` | 更新日時 |
| I | `likesCount` | いいね数 (キャッシュ的役割) |
| J | `thumbnailUrl` | サムネイル画像URL |
| K | `status` | `open`, `closed`, `resolved` など |
| L | `metadata` | カテゴリ固有データをJSONで格納 (例: `{url: "...", deadline: "..."}`) |

#### 2. `Comments` シート
コメントを別シートに切り出し、管理しやすくする。

| 列 | 項目名 | 内容 |
| :--- | :--- | :--- |
| A | `id` | コメントID |
| B | `postId` | 親記事のID (`Posts.id`) |
| C | `content` | コメント本文 |
| D | `author` | 投稿者 |
| E | `postedAt` | 投稿日時 |

#### 3. `Likes` シート
「誰が何にいいねしたか」を記録し、お気に入り機能や重複いいね防止に対応する。
（※ 匿名運用の場合は簡易的に Cookie/LocalStorage との併用になるが、今回はユーザー識別子がないため、ブラウザ側の「お気に入りリスト」と連動させる形を想定するか、簡易的なユーザーIDをLocalStorageで生成するか要検討。一旦は「ブラウザ単位」でのお気に入り管理とする）

## 5. 実装・移行ステップ

1.  **基盤整備**:
    *   スプレッドシートの新規シート作成（`Posts`, `Comments`）。
    *   現行データの移行スクリプト作成・実行。
2.  **バックエンド (Service層) 修正**:
    *   `KnowledgeService` をカテゴリ対応、複数シート対応に改修。
    *   検索ロジックのアップデート。
3.  **フロントエンド刷新**:
    *   ライブラリ導入 (`EasyMDE`, ルーティング用自作ロジック等)。
    *   サイドバー + メインエリアのHTML/CSS実装。
    *   各カテゴリの入力フォーム・表示コンポーネント実装。
4.  **URLルーティング実装**:
    *   `doGet` でのパラメータ処理。
    *   `History API` を使ったクライアントサイド遷移。

## 6. 現在の実装状況 (2025/11/20追記)
*   **構成**: GAS + TypeScript (clasp, esbuild)。`src/`以下にソースコード、`dist/`にビルド成果物。
*   **機能**:
    *   記事一覧・詳細・追加・編集・いいね・コメント機能（全て1シート `シート1` で運用中）。
    *   **高速化**: `CacheService` によるデータキャッシュ、初期データ (`initialData`) のHTML埋め込みによるSSR的挙動、クライアントサイド検索。
    *   **詳細表示**: 現在はモーダル表示。URLパラメータによる遷移は未実装。
*   **課題**: 1シート運用の限界、UIの古さ、URL共有ができない。

## 7. 次期開発の優先順位
1.  **URLルーティングの基礎実装**: まずは既存のUIのまま、`?id=123` で詳細が開くようにする。
2.  **スプレッドシート移行**: 新スキーマへの移行とデータ移行ツールの作成。
3.  **UIリニューアル**: NotionライクなUIへの刷新と新機能（カテゴリ、EasyMDEなど）の実装。
