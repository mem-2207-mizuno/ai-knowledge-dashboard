# AI Knowledge Dashboard リニューアル計画

## 関連ドキュメント

- [Spreadsheet Schema](../specs/spreadsheet-schema.md): スプレッドシートの正規化設計と移行手順
- [UI Layout Overview](./ui-layout.md): Notionライクな2カラムUIの構造とインタラクション
- [System Overview](../architecture/system-overview.md): ランタイム構成とデータフロー
- [Documentation Guidelines](../guides/documentation-guidelines.md): ドキュメント作成時のルール

## 1. コンセプト

**「NotionライクなモダンUI」** を目指し、情報のストック・フロー両面で使いやすいダッシュボードへ刷新する。
GAS + スプレッドシートの構成を維持しつつ、SPA（Single Page Application）ライクな挙動とURLによる状態管理（Deep Linking）を実現する。

## 2. UI/UX設計

### 2.1 レイアウト構成

画面を左右に分割する2カラムレイアウトを採用。

- **左：サイドバー（固定）**
  - **検索ボックス**: フリーワード検索（リアルタイムフィルタ）。
  - **新規作成ボタン**: 投稿モーダル/画面を開く。
  - **メニュー**:
    - 🏠 **ホーム（ダッシュボード）**: カテゴリごとの新着・人気などをサマリ表示。
    - ⭐ **お気に入り (Favorite)**: 自分がいいねした記事一覧。
  - **カテゴリ（大きな枠組み）**:
    - 📰 **気になる記事** (Articles)
    - ❓ **相談・質問** (Questions)
    - 🤝 **仲間募集** (Recruitment)
    - 🎁 **成果物紹介** (Showcase)
  - **タグ一覧**: 使用頻度の高いタグトップ10などを表示。

- **右：メインエリア（可変）**
  - 選択されたメニューに応じたコンテンツを表示。
  - **一覧表示**: カード型レイアウト（カテゴリごとに最適化）。
  - **詳細表示**: モーダルではなく、全画面（またはオーバーレイ）でリッチに表示。

### 2.2 URL設計 (Deep Linking)

クエリパラメータ `page` と `id` を使用して状態を管理する。

| 画面             | URLパターン                         | 挙動                                                     |
| :--------------- | :---------------------------------- | :------------------------------------------------------- |
| **ホーム**       | `/exec`                             | ダッシュボードを表示。                                   |
| **カテゴリ一覧** | `/exec?page=category&type=articles` | 特定カテゴリの一覧を表示。                               |
| **詳細記事**     | `/exec?id=123`                      | 指定IDの記事詳細を表示（pageパラメータなしでもID優先）。 |
| **タグ検索**     | `/exec?page=tag&name=gas`           | 特定タグの記事一覧を表示。                               |
| **お気に入り**   | `/exec?page=favorite`               | お気に入り一覧を表示。                                   |

## 3. 機能要件詳細

### 3.1 カテゴリと入力フォーマット

4つのカテゴリごとに、入力項目と表示項目を最適化する。

| カテゴリ         | キー          | 特有の入力項目               | 表示時の特徴                                              |
| :--------------- | :------------ | :--------------------------- | :-------------------------------------------------------- |
| **気になる記事** | `article`     | 参照URL (必須), 要約         | URLのOGP（もし取得できれば）やサムネイルを強調。          |
| **相談・質問**   | `question`    | 現状の課題, 解決希望日       | 「未解決/解決済み」のステータス管理。                     |
| **仲間募集**     | `recruitment` | プロジェクト概要, 募集ロール | 「募集中/終了」ステータス。募集ロールをタグのように表示。 |
| **成果物紹介**   | `showcase`    | デモURL, GitHub URL, 工夫点  | スクリーンショット（サムネイル）を大きく表示。            |

※ 共通項目: タイトル, 詳細説明(Markdown), タグ, 投稿者

### 3.2 リッチテキストエディタ (Markdown)

詳細説明欄には **EasyMDE** (またはSimpleMDE) を導入。

- **機能**: 太字、リスト、リンク、引用などの入力補助ツールバー。
- **プレビュー**: 入力しながらプレビューが見られる、または切り替え表示。

### 3.3 タグ管理

- **入力UI**: 既存のタグを候補として表示するオートコンプリート機能。
- **データソース**: 記事データから全タグを集計して候補リストを動的に生成（マスタシートは作らずメンテナンスフリーに）。

## 4. データモデル設計

スプレッドシートの正規化済みスキーマやシートごとの列構成は [Spreadsheet Schema](../specs/spreadsheet-schema.md) を参照。そちらに ER 図と移行ステップをまとめているため、本ドキュメントでは「複数シート構成へ移行する」という方針のみ記す。

## 5. 実装・移行ステップ

1.  **基盤整備**:
    - スプレッドシートの新規シート作成（`Posts`, `Comments`）。
    - 現行データの移行スクリプト作成・実行。
2.  **バックエンド (Service層) 修正**:
    - `KnowledgeService` をカテゴリ対応、複数シート対応に改修。
    - 検索ロジックのアップデート。
3.  **フロントエンド刷新**:
    - ライブラリ導入 (`EasyMDE`, ルーティング用自作ロジック等)。
    - サイドバー + メインエリアのHTML/CSS実装。
    - 各カテゴリの入力フォーム・表示コンポーネント実装。
4.  **URLルーティング実装**:
    - `doGet` でのパラメータ処理。
    - `History API` を使ったクライアントサイド遷移。

## 6. 現在の実装状況 (2025/11/20 更新)

- **構成**: GAS + TypeScript (bun + esbuild)。`dist/` にビルド成果物を出力し、`clasp push` でデプロイ。
- **機能**:
  - URL ルーティング（`?id=123`）と SSR 初期データを組み合わせた SPA 表示。
  - Posts / Tags / PostTags / Comments / Likes シートへの移行と `MigrationService` による一括移行機能。
  - コメント・いいねの楽観的 UI / LocalStorage による clientId といいね状態管理。
- **課題**:
  - UI リニューアル（Notion ライクな 2 カラム）はプロトタイピング段階。
  - Markdown エディタ、タグオートコンプリートなどの導入。
  - カテゴリ固有フォームや詳細画面の再設計。

## 7. 次期開発の優先順位

1. UI リニューアル: 2 カラムレイアウトとカテゴリ別表示の UI を実装。
2. 入力エクスペリエンス改善: EasyMDE / タグオートコンプリート / カテゴリ固有項目の編集体験を向上。
3. 分析系機能: お気に入り一覧やカテゴリ/タグ別ダッシュボードの実装。
